<!DOCTYPE html>
<html>
    <head>        
        <!-- title -->
        <title>Greater Anglia | Report a Fault</title>

        <!-- Metadata -->
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
        <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
        <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
        <!-- Good default declaration:
        * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
        * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
        * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
            * Enable inline JS: add 'unsafe-inline' to default-src
            * Enable eval(): add 'unsafe-eval' to default-src
        * Create your own at http://cspisawesome.com
        -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
        <link rel="manifest" href="/favicon/site.webmanifest">
        <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#da1a35">
        <link rel="shortcut icon" href="/favicon/favicon.ico">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-config" content="/favicon/browserconfig.xml">
        <meta name="theme-color" content="#ffffff">

        <!-- Get Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Roboto%7CHelvetica+Neue" rel="stylesheet">

        <!-- Get CSS -->
        <link href="assets/styles/normalize.min.css" rel="stylesheet" type="text/css" media="screen" />
        <link rel="stylesheet" type="text/css" href="assets/styles/materialize.min.css" />
        <link rel="stylesheet" type="text/css" href="assets/styles/master.css" />
        <link rel="stylesheet" type="text/css" href="assets/styles/index.css" />
    </head>

    <body>
        <header>
            <nav class="invert">                 
                <div class="container">
                    <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                    <div class="title">
                        <div>Report a Fault</div>
                    </div>
                </div>
            </nav>

            <ul id="slide-out" class="sidenav">
                <li><a class="subheader">Menu</a></li>
                <li><div class="divider"></div></li>
                <li><a class="waves-effect" href="index.html"><i class="material-icons">home</i>Home</a></li>
                <li><a class="waves-effect" href="feed.html"><i class="material-icons">dashboard</i>Feed</a></li>
                <li><a class="waves-effect" href="report.html"><i class="material-icons">add</i>Report a Fault</a></li>

                <a class="modal-trigger mode-selector" href="#!"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M0 12c0 6.627 5.373 12 12 12s12-5.373 12-12S18.627 0 12 0 0 5.373 0 12zm2 0C2 6.486 6.486 2 12 2v20C6.486 22 2 17.514 2 12z"/></svg></a>
                <a class="modal-trigger language-selector" href="#language-selector"><img src="assets/images/united-kingdom.svg" alt="United Kingdom"></a>
            </ul>

            <div id="language-selector" class="modal">
                <div class="modal-content modal-title">
                    <span class="title">Language Selector</span>
                </div>
                <form action="#!">
                    <ul class="collection">
                        <a href="#!" class="collection-item active">
                            <img src="assets/images/united-kingdom.svg" alt="United Kingdom">
                            <span>United Kingdom</span>
                        </a>
                        <a href="#!" class="collection-item">
                            <img src="assets/images/germany.svg" alt="Deutsch">
                            <span>Deutsch</span>
                        </a>
                        <a href="#!" class="collection-item">
                            <img src="assets/images/france.svg" alt="François">
                            <span>François</span>
                        </a>
                        <a href="#!" class="collection-item">
                            <img src="assets/images/spain.svg" alt="Español">
                            <span>Español</span>
                        </a>
                        <a href="#!" class="collection-item">
                            <img src="assets/images/portugal.svg" alt="Portugués">
                            <span>Portugués</span>
                        </a>
                        <a href="#!" class="collection-item">
                            <img src="assets/images/italy.svg" alt="Itália">
                            <span>Itália</span>
                        </a>
                    </ul>
                    <button class="modal-close waves-effect btn" type="submit" name="action">Select Language</button>
                </form>
            </div>

            <div id="modal-submitted" class="modal">
                <div class="modal-content">
                    <span class="title">Report Submitted!</span>                    
                    <p>Thank you for submitting a fault! You can sit back and relax now, we will try and get the issue resolved as soon as possible!</p>
                </div>
                <div class="modal-footer">
                    <a href="index.html" class="modal-close waves-effect waves-red btn-flat">Return Home</a>
                    <a href="#!" class="modal-close waves-effect waves-red btn-flat">Report Another Fault</a>
                </div>
            </div>

            <div id="modal-warning" class="modal">
                <div class="modal-content">
                    <span class="title">Warning</span>                    
                    <p>Are you sure you want to exit and lose you report? If you leave now, your changes will be lost and the report won't be posted.</p>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                    <a href="#!" class="modal-close waves-effect waves-red btn-flat">Continue</a>
                </div>
            </div>
        </header>

        <main>
            <div class="container padding-small">
                <div class="row">
                    <form onSubmit="return reportFault()" id="report-form" data-ajax="false" class="col s12">
                        <div class="row">
                            <div class="input-field col s11">
                                <input id="staff-id" type="number" data-length="6" class="validate">
                                <label for="staff-id">Staff ID</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Barcode number found on Greater Anglia ID card.">help</i>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s3">
                                <input id="train-no" type="number" data-length="5" class="validate">
                                <label for="train-no">Train No.</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Train number found on the front of the train.">help</i>
                            </div>
                            <div class="input-field col s3">
                                <input id="coach-no" type="text" data-length="5" class="validate">
                                <label for="coach-no">Coach No.</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Coach number fault occured in as found at entrance to coach.">help</i>
                            </div>
                            <div class="input-field col s3">
                                <input id="seat-no" type="number" data-length="3" class="validate">
                                <label for="seat-no">Seat No.</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="If fault was seat related, the seat number of fault as found on the seat or above window.">help</i>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s5">
                                <input id="from-location" type="text" class="validate">
                                <label for="from-location">Departure Location</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Departure location you were/are travelling from.">help</i>
                            </div>
                            <div class="input-field col s5">
                                <input id="to-location" type="text" class="validate">
                                <label for="to-location">Destination Location</label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Destination location you were/are travelling to.">help</i>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s5">
                                <input id="fault-date" type="text" class="datepicker validate" required>
                                <label for="fault-date">Date of Fault</label>
                                <span class="helper-text" data-error="Date Invalid" data-success="Required*">Required*</span>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Date fault occured or was found.">help</i>
                            </div>
                            <div class="input-field col s5">
                                <input id="fault-time" type="text" class="timepicker validate" required>
                                <label for="fault-time">Time of Fault</label>
                                <span class="helper-text" data-success="Required*">Required*</span>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Time fault occured or was found.">help</i>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s12">
                                <div class="row">
                                    <div class="input-field col s11">
                                        <i class="material-icons prefix">search</i>
                                        <input id="fault-type" type="text" data-length="32" class="autocomplete validate" required>
                                        <label for="fault-type">Fault Type</label>
                                        <span class="helper-text" data-success="Required*">Required*</span>
                                    </div>
                                    <div class="input-field col s1 tool-tip-container">
                                        <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Fault type to found.">help</i>
                                    </div>
                                </div>
                            </div>
                        </div>
                         <div class="row">
                            <div class="input-field col s11">
                                <textarea id="fault-desc" class="materialize-textarea validate" data-length="256" required></textarea>
                                <label for="fault-desc">Fault Description</label>
                                <span class="helper-text" data-success="Required*">Required*</span>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Description of fault found.">help</i>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-image col s11">
                                <input id="fault-photo" type="file" accept="image/*" />
                                <label for="fault-photo" id="fileDrag" class="transition-2s">
                                    <span>Upload Fault Photo...</span>
                                </label>
                            </div>
                            <div class="input-field col s1 tool-tip-container">
                                <i class="material-icons tool-tip" data-position="bottom" data-tooltip="Photo of fault found.">help</i>
                            </div> 
                        </div>
                        <div class="button-container">
                            <button class="btn waves-effect waves-light" type="submit" name="action">Submit Fault</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>

        <!-- Get Scripts -->
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="assets/scripts/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="assets/scripts/materialize.min.js"></script>
        <script type="text/javascript" src="assets/scripts/file.js"></script>
        <script type="text/javascript" src="assets/scripts/database.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                $('.sidenav').sidenav();  

                // Models
                $('#modal-submitted').modal(); 
                $('#language-selector').modal();

                // Auto Complete
                $('input.autocomplete').autocomplete({
                    data: {
                        "Seat Fault": null,
                        "Toilet Fault": null,
                        "Information": null,
                        "Safety & Security": null,
                        "Maintenance": null,
                        "Cleanliness": null,
                        "Dirty": null,
                        "Rubbish": null,
                        "Presentation": null
                    },
                });

                // Character Counters
                $('input#staff-id, input#train-no, input#coach-no, input#seat-no, input#fault-type, textarea#fault-desc').characterCounter();

                // Tooltips
                $('.tool-tip').tooltip();

                document.getElementById('fault-photo').onclick = function() {
                    navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
                        destinationType: Camera.DestinationType.DATA_URL
                    });
                };
            });

            function onSuccess(data){
               var image = document.getElementById("fileDrag");
               image.src = "data:image/jpeg;base64," + data;
               base64imageData = data;
            }

            function onFail(message) {
                console.log('Photo Upload Failed: ' + message);
            }

            document.addEventListener('DOMContentLoaded', function() {
                // Timepicker
                var timepicker = document.querySelectorAll('.timepicker');
                M.Timepicker.init(timepicker, {
                    defaultTime: 'now',
                    vibrate: false
                });

                // Datepicker
                var datepicker  = document.querySelectorAll('.datepicker');
                var today = new Date();
                var date = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                M.Datepicker.init(datepicker , {
                    defaultDate: date,
                    setDefaultDate: true
                }).setDate(date);
            });

            // window.onload = function() {
            //     window.addEventListener("beforeunload", function (e) {
            //         if (submitted)
            //             return undefined;

            //         $('#modal-warning').modal('open'); 

            //         var confirmationMessage = 'It looks like you have been editing something. '
            //                                 + 'If you leave before saving, your changes will be lost.';

            //         (e || window.event).returnValue = confirmationMessage; //Gecko + IE
            //         return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
            //     });
            // };

            // window.onload = function() {
            //     var today = new Date();
            //     $('.timepicker').val(today.toLocaleString('en-GB', { hour: 'numeric', minute: 'numeric', hour12: true, minimumIntegerDigits: 4, minimumFractionDigits: 2, useGrouping: false }));
            // };      
            </script>
    </body>
</html>